import{k as B,B as F,M as y,l,m as M,o,a as $,w as g,x as w,b as u,d as t,u as a,f as c,t as x,F as A,e as W,n as V,y as G,I as O,L as q,h as z,C as H,c4 as b,bY as k}from"./index-f9156b00.js";import{W as J}from"./WrappedLoadingSpinner-f4d02455.js";import{h as S}from"./moment-fbc5633a.js";import{_ as P}from"./SubmitButton-44f80f79.js";import{u as j,g as K,_ as Q,m as X,a as Z,n as ee,r as te}from"./validation-6d9fc5a7.js";import{c as ae}from"./particles-1ce637ad.js";import"./LoadingSpinner-ce5a1d0f.js";const se=t("h2",{class:"text-main"},"Email Verification",-1),oe={key:0},ie={class:"fs-2 fw-semibold mb-0"},ne=t("span",null," You have tried to send an email too many times, please wait until the timer expires and then the email will be automatically resent. ",-1),re={key:2},le={class:"fw-semibold"},ce=["onSubmit"],de={class:"text-start"},me=t("label",{class:"form-label text-main"},"Verification code",-1),ue={class:"text-center mt-3 mb-2"},fe=t("span",{class:"me-1"},"Didn't receive an email ?",-1),Ve={__name:"EmailVerificationView",setup(pe){const f=B(),p=F(),E=y(p.getters["auth/user"]),d=l(!1),m=l(!1),i=E.isVerified,_=y({code:""}),L={code:{minLength:X(b),maxLength:Z(b),numeric:ee,required:te}},n=j(L,_),h=l(null),s=l(0),C=e=>S(Date.parse(e)-new Date).seconds(),R=()=>f.go(0);function I(){const e=setInterval(async()=>{s.value>0?s.value--:(clearInterval(e),await v())},1e3)}async function v(){m.value=!0;try{if(!i){const e=await w.users.sendEmailVerification(),r=e.data;e.status===201&&(h.value=S(r.expiration).format("LLL"))}}catch(e){e.response.status===429?(s.value=C(e.response.data.messages.retryAfter),I()):console.error(e)}finally{m.value=!1}}const T={name:"accountSettingsTab"};async function D(){p.commit("auth/verifyUser"),ae(),k.success("Your email has been successfully verified."),await f.push(T)}function N(e){e.response.status===400&&e.response.data.code==="invalid_verification_code"?k.error("The entered code is incorrect, please make sure you entered it correctly, or send a new email."):console.error(e)}async function U(){d.value=!0;try{(await w.users.verifyUser({code:_.code})).status===200&&await D()}catch(e){N(e)}finally{d.value=!1}}return M(async()=>{await v()}),(e,r)=>(o(),$(J,{text:"Sending you an email...","is-loading":m.value},{default:g(()=>[u(H,{class:"container text-center col-xxl-6 col-lg-7 col-md-10 col-sm-12"},{default:g(()=>[se,t("div",{class:V(["alert alert-primary common-rounding mb-0 fs-5 fw-medium",a(i)?"alert-warning":"alert-primary"])},[a(i)?(o(),c("span",oe,"Your email has already been verified.")):s.value>0?(o(),c(A,{key:1},[t("p",ie,x(s.value),1),ne],64)):(o(),c("span",re,[W(" You're almost there! You will receive an email within a couple of minutes. Just enter the code from the email into the form to complete your verification if you don't see it, you may need to check your spam folder. The code will be valid until: "),t("span",le,x(h.value),1)]))],2),a(i)?z("",!0):(o(),c("form",{key:0,onSubmit:q(U,["prevent"]),class:"mt-3"},[t("div",de,[me,G(t("input",{"onUpdate:modelValue":r[0]||(r[0]=Y=>a(n).code.$model=Y),type:"text",class:V(["form-control only-bottom-border",a(K)(a(n).code)]),placeholder:"Enter a verification code"},null,2),[[O,a(n).code.$model]]),u(Q,{field:a(n).code},null,8,["field"])]),t("div",ue,[u(P,{"show-loading":d.value},null,8,["show-loading"])]),t("div",{class:"text-center"},[t("p",{class:"mb-0"},[fe,t("a",{onClick:R,href:"",class:"link link-primary text-decoration-none"}," Get a new one. ")])])],40,ce))]),_:1})]),_:1},8,["is-loading"]))}};export{Ve as default};
